# GC-MS 数据分析深度学习项目

## 项目概述

本项目是一个基于深度学习的气相色谱-质谱（GC-MS）数据分析系统，主要用于对不同类型的化合物进行自动分类识别。该系统采用了基于ResNet的一维卷积神经网络架构，能够有效处理和分析GC-MS产生的光谱数据。

## 技术特性

### 数据处理

- 支持CSV格式的GC-MS数据文件读取
- 实现了Savitzky-Golay滤波进行数据平滑处理（窗口长度11，多项式阶数3）
- 使用StandardScaler进行数据标准化
- 支持4种不同药材的部分分类：APCK、FRCK、RACK、RHCK

### 模型架构

- 基于ResNet架构的一维卷积神经网络
- 网络结构：
  - 初始卷积层：32通道，7x1卷积核，步长2
  - 4个残差块层，通道数从32逐步增加到256
  - 每个残差块包含两个3x1卷积层和批归一化层
  - 使用自适应平均池化进行特征提取
  - 最终全连接层输出4个类别
- 使用Batch Normalization和Dropout(0.1)进行正则化
- 采用Kaiming初始化优化权重初始值

### 训练策略

- 实现了K折交叉验证（默认6折）
- 优化器：AdamW（权重衰减0.0001）
- OneCycleLR学习率调度器配置：
  - 最大学习率：0.001
  - 预热阶段比例：40%
  - 使用余弦退火策略
  - 初始学习率为最大学习率的1/25
  - 最终学习率为初始学习率的1/1000
- 实现了基于验证损失和F1分数的早停机制：
  - 耐心值：15轮
  - 最小改善阈值：0.0005
  - 最小训练轮数：10轮
- 数据增强策略：
  - 随机噪声注入（标准差0.002）
  - 时间序列随机移位（±3个点）
- 梯度裁剪（最大范数0.5）防止梯度爆炸

### 性能监控

- 支持多个评估指标：准确率、精确率、召回率、F1分数
- 自动绘制学习曲线和性能指标变化图
- 保存每个fold的最佳模型和训练结果
- 生成详细的训练报告和模型信息
- 支持模型断点保存和加载

## 项目结构

```plaintext
.
├── data/               # 数据目录
├── models/            # 模型保存目录
├── AI_GCMS.py        # 主程序文件
└── README.md         # 项目文档
```

## 主要功能模块

### 1. 数据加载与预处理 (load_data)

- 自动识别和加载CSV格式的数据文件
- 进行数据平滑和标准化处理
- 组织数据为适合深度学习的格式
- 自动进行类别标签编码

### 2. 数据集管理 (ChromatographyDataset)

- 继承自PyTorch的Dataset类
- 实现数据增强功能：
  - 随机噪声注入
  - 时间序列移位
- 支持批量数据加载
- 动态数据增强控制

### 3. 模型架构 (ResNet1D)

- 实现了一维ResNet网络
- 包含基础残差块和主干网络结构
- 支持可配置的网络深度和宽度
- 优化的权重初始化策略

### 4. 训练管理 (train_with_cross_validation)

- 实现完整的训练流程
- 支持交叉验证
- 包含早停机制
- 自动保存最佳模型
- 学习率动态调整

### 5. 模型评估与可视化

- 计算多个性能指标
- 生成训练过程的可视化图表
- 保存详细的评估结果
- 支持每个fold的独立评估

## 使用方法

### 训练模型

```python
from AI_GCMS import train_with_cross_validation

# 使用默认参数进行训练
results = train_with_cross_validation(
    data_dir='data',
    n_folds=6,
    n_epochs=150,
    batch_size=16,
    device='cuda'
)
```

### 加载已训练模型

```python
from AI_GCMS import load_model

model = load_model('models/final_model.pth')
```

## 性能优化

本项目包含多个性能优化策略：

1. 使用OneCycleLR进行学习率调度，包含预热和余弦退火阶段
2. 实现梯度裁剪（阈值0.5）防止梯度爆炸
3. 使用Dropout(0.1)和BatchNorm进行正则化
4. 支持数据增强提高模型鲁棒性
5. 实现早停机制防止过拟合
6. 使用AdamW优化器并配置权重衰减
7. 优化的模型权重初始化策略

## 输出文件

项目在训练过程中会生成以下文件：

- `models/best_model_fold{n}.pth`：每个fold的最佳模型
- `models/model_info_fold{n}.txt`：每个fold的详细信息，包含：
  - 最佳轮次
  - 准确率、精确率、召回率、F1分数
- `models/final_model.pth`：最终模型
- `models/final_results.txt`：综合训练结果报告，包含所有fold的平均性能指标
